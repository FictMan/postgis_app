<p style="color: green"><%= notice %></p>

<h1>Fields</h1>

<table class="fields-table">
  <thead>
    <tr>
      <th>Field Name</th>
      <th>Area (sq meters)</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% @fields.each do |field| %>
      <tr>
        <td><%= link_to field.name, field_path(field) %></td>
        <td><%= field.area %></td>
        <td>
          <%= link_to 'Show', field_path(field), class: "btn-show" %> |
          <%= link_to 'Edit', edit_field_path(field), class: "btn-edit" %>
        </td>
      </tr>
    <% end %>
  </tbody>

  <div id="map" class="map-container" style="height: 400px;"></div>
</table>

<%= link_to "New field", new_field_path %>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    var osmUrl = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
    var osm = L.tileLayer(osmUrl, { maxZoom: 18 });
    var map = new L.Map('map', { center: new L.LatLng(45, 10), zoom: 3 }); 
    var drawnItems = L.featureGroup().addTo(map);

    L.control.layers({
      'osm': osm.addTo(map),
      "google": L.tileLayer('http://www.google.cn/maps/vt?lyrs=s@189&gl=cn&x={x}&y={y}&z={z}', { attribution: 'google' })
    }, { drawlayer: drawnItems }, { position: 'topleft', collapsed: false }).addTo(map);

    <%= raw @geojsons.to_json %>.map((shape) => L.geoJSON(shape).addTo(map))
  });
</script>
